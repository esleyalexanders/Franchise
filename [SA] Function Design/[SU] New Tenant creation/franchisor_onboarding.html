<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Franchisor Onboarding</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f5f7fa; color: #333; line-height: 1.6; }
        .container { max-width: 1000px; margin: 0 auto; padding: 40px 20px; }
        .header { text-align: center; margin-bottom: 40px; }
        .subtitle { color: #6c757d; margin-top: 8px; font-size: 16px; }
        .progress-bar { height: 6px; background: #e9ecef; border-radius: 3px; margin-bottom: 40px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #007bff, #28a745); width: 0%; transition: width 0.5s ease; }
        .onboarding-card { background: white; border-radius: 16px; padding: 40px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); margin-bottom: 32px; }
        .section-title { font-size: 24px; font-weight: 700; color: #2c3e50; margin-bottom: 8px; }
        .section-description { color: #6c757d; margin-bottom: 32px; font-size: 16px; }
        .form-section { margin-bottom: 40px; padding-bottom: 32px; border-bottom: 1px solid #e9ecef; }
        .form-section:last-child { border-bottom: none; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 24px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group.full-width { grid-column: 1 / -1; }
        label { font-weight: 500; margin-bottom: 6px; color: #495057; }
        .required { color: #dc3545; }
        input, select, textarea { padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; transition: border-color 0.3s ease; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #007bff; }
        textarea { resize: vertical; min-height: 100px; }
        .file-upload { border: 2px dashed #007bff; border-radius: 8px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.3s ease; }
        .file-upload:hover { background: #f8f9ff; }
        .file-upload.dragover { background: #e7f3ff; border-color: #0056b3; }
        .upload-icon { font-size: 48px; color: #007bff; margin-bottom: 16px; }
        .upload-text { color: #6c757d; }
        .upload-hint { font-size: 12px; color: #6c757d; margin-top: 8px; }
        .preview-section { margin-top: 20px; }
        .logo-preview { width: 120px; height: 120px; border: 2px solid #e9ecef; border-radius: 8px; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .logo-preview img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .color-picker { display: flex; gap: 12px; flex-wrap: wrap; }
        .color-option { width: 50px; height: 50px; border-radius: 8px; cursor: pointer; border: 3px solid transparent; transition: all 0.3s ease; }
        .color-option.selected { border-color: #333; transform: scale(1.1); }
        .actions { display: flex; gap: 16px; justify-content: space-between; align-items: center; }
        .btn { padding: 14px 28px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; transition: all .2s ease; }
        .btn-primary { background: #007bff; color: white; }
        .btn-primary:hover { background: #0056b3; transform: translateY(-1px); }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #5a6268; }
        .btn-outline { background: transparent; color: #6c757d; border: 2px solid #6c757d; }
        .btn-outline:hover { background: #6c757d; color: white; }
        .step-indicator { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; }
        .step { width: 12px; height: 12px; border-radius: 50%; background: #e9ecef; transition: background 0.3s ease; }
        .step.active { background: #007bff; }
        .step.completed { background: #28a745; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Welcome to Your Franchisor Dashboard</h1>
            <div class="subtitle">Let's set up your brand identity and get you started</div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="step-indicator">
            <div class="step active" data-step="1"></div>
            <div class="step" data-step="2"></div>
            <div class="step" data-step="3"></div>
        </div>

        <form class="onboarding-card" id="onboardingForm">
            <!-- Step 1: Brand Basics -->
            <div class="form-section" data-step="1">
                <h2 class="section-title">Brand Identity Basics</h2>
                <p class="section-description">Set up your core brand elements that will be used across your franchise network.</p>

                <div class="form-row">
                    <div class="form-group">
                        <label for="brandName">Brand Name <span class="required">*</span></label>
                        <input type="text" id="brandName" required placeholder="e.g., BurgerMaster">
                    </div>
                    <div class="form-group">
                        <label for="tagline">Tagline/Slogan</label>
                        <input type="text" id="tagline" placeholder="e.g., Taste the Difference">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Logo Upload</label>
                        <div class="file-upload" id="logoUpload">
                            <div class="upload-icon">📷</div>
                            <div class="upload-text">Click to upload your logo or drag and drop</div>
                            <div class="upload-hint">PNG, JPG up to 5MB</div>
                            <input type="file" id="logoFile" accept="image/*" style="display: none;">
                        </div>
                        <div class="preview-section">
                            <div class="logo-preview" id="logoPreview">
                                <span style="color: #6c757d;">No logo uploaded</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Brand Colors & Style -->
            <div class="form-section" data-step="2" style="display: none;">
                <h2 class="section-title">Brand Colors & Visual Style</h2>
                <p class="section-description">Choose colors and styling that represent your brand personality.</p>

                <div class="form-row">
                    <div class="form-group">
                        <label>Primary Brand Color</label>
                        <div class="color-picker" id="primaryColors">
                            <div class="color-option" style="background: #007bff;" data-color="#007bff"></div>
                            <div class="color-option" style="background: #28a745;" data-color="#28a745"></div>
                            <div class="color-option" style="background: #dc3545;" data-color="#dc3545"></div>
                            <div class="color-option" style="background: #ffc107;" data-color="#ffc107"></div>
                            <div class="color-option" style="background: #6f42c1;" data-color="#6f42c1"></div>
                            <div class="color-option" style="background: #fd7e14;" data-color="#fd7e14"></div>
                            <div class="color-option" style="background: #20c997;" data-color="#20c997"></div>
                            <div class="color-option" style="background: #e83e8c;" data-color="#e83e8c"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Secondary Brand Color</label>
                        <div class="color-picker" id="secondaryColors">
                            <div class="color-option" style="background: #6c757d;" data-color="#6c757d"></div>
                            <div class="color-option" style="background: #f8f9fa;" data-color="#f8f9fa"></div>
                            <div class="color-option" style="background: #343a40;" data-color="#343a40"></div>
                            <div class="color-option" style="background: #495057;" data-color="#495057"></div>
                            <div class="color-option" style="background: #adb5bd;" data-color="#adb5bd"></div>
                            <div class="color-option" style="background: #dee2e6;" data-color="#dee2e6"></div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="fontFamily">Preferred Font Family</label>
                        <select id="fontFamily">
                            <option value="Arial, sans-serif">Arial</option>
                            <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Segoe UI</option>
                            <option value="'Helvetica Neue', Helvetica, Arial, sans-serif">Helvetica</option>
                            <option value="Georgia, 'Times New Roman', Times, serif">Georgia</option>
                            <option value="'Times New Roman', Times, serif">Times New Roman</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="brandVoice">Brand Voice/Tone</label>
                        <select id="brandVoice">
                            <option value="professional">Professional</option>
                            <option value="friendly">Friendly & Approachable</option>
                            <option value="energetic">Energetic & Fun</option>
                            <option value="premium">Premium & Luxury</option>
                            <option value="traditional">Traditional & Reliable</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Step 3: Operational Preferences -->
            <div class="form-section" data-step="3" style="display: none;">
                <h2 class="section-title">Operational Preferences</h2>
                <p class="section-description">Configure settings that will apply to your entire franchise network.</p>

                <div class="form-row">
                    <div class="form-group">
                        <label for="timezone">Default Timezone</label>
                        <select id="timezone">
                            <option value="Australia/Sydney">Sydney (AEST)</option>
                            <option value="Australia/Melbourne">Melbourne (AEST)</option>
                            <option value="Australia/Brisbane">Brisbane (AEST)</option>
                            <option value="Australia/Perth">Perth (AWST)</option>
                            <option value="Australia/Adelaide">Adelaide (ACST)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="currency">Default Currency</label>
                        <select id="currency">
                            <option value="AUD">Australian Dollar (AUD)</option>
                            <option value="USD">US Dollar (USD)</option>
                            <option value="NZD">New Zealand Dollar (NZD)</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group full-width">
                        <label for="brandGuidelines">Brand Guidelines & Standards</label>
                        <textarea id="brandGuidelines" placeholder="Describe your brand standards, quality requirements, and operational guidelines that franchisees must follow..."></textarea>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group full-width">
                        <label for="welcomeMessage">Welcome Message for New Franchisees</label>
                        <textarea id="welcomeMessage" placeholder="This message will be shown to new franchisees when they first access their account..."></textarea>
                    </div>
                </div>
            </div>
        </form>

        <div class="actions">
            <button class="btn btn-outline" id="backBtn" onclick="previousStep()" style="display: none;">← Back</button>
            <div></div>
            <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">Continue →</button>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 3;

        // Check authentication before allowing access
        function checkAuthentication() {
            // In a real app, this would check for a valid session/token
            // For demo purposes, check if user came from login or has recent login data
            const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true' ||
                              sessionStorage.getItem('authenticated') === 'true' ||
                              document.referrer.includes('auth_signin.html') ||
                              document.referrer.includes('franchisor_login.html');

            if (!isLoggedIn) {
                // Redirect to franchisor login
                window.location.href = 'franchisor_login.html';
                return false;
            }

            // Mark as authenticated for this session
            sessionStorage.setItem('authenticated', 'true');
            return true;
        }

        // Initialize form with any existing data
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkAuthentication()) {
                return; // Don't proceed if not authenticated
            }

            initializeForm();
            setupFileUpload();
            setupColorPickers();
        });

        function initializeForm() {
            // Load any existing franchisor data if available
            const franchisorData = JSON.parse(localStorage.getItem('franchisorFormData') || '{}');

            if (franchisorData.businessName) {
                document.getElementById('brandName').value = franchisorData.businessName;
            }

            updateProgress();
        }

        function setupFileUpload() {
            const uploadArea = document.getElementById('logoUpload');
            const fileInput = document.getElementById('logoFile');

            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileUpload(files[0]);
                }
            });

            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            });
        }

        function handleFileUpload(file) {
            if (!file.type.startsWith('image/')) {
                alert('Please upload an image file.');
                return;
            }

            if (file.size > 5 * 1024 * 1024) { // 5MB
                alert('File size must be less than 5MB.');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('logoPreview').innerHTML = `<img src="${e.target.result}" alt="Logo preview">`;
            };
            reader.readAsDataURL(file);
        }

        function setupColorPickers() {
            ['primaryColors', 'secondaryColors'].forEach(pickerId => {
                const picker = document.getElementById(pickerId);
                const options = picker.querySelectorAll('.color-option');

                options.forEach(option => {
                    option.addEventListener('click', () => {
                        // Remove selected class from siblings
                        options.forEach(opt => opt.classList.remove('selected'));
                        // Add selected class to clicked option
                        option.classList.add('selected');
                    });
                });
            });
        }

        function nextStep() {
            if (!validateCurrentStep()) {
                return;
            }

            if (currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
            } else {
                completeOnboarding();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }

        function showStep(step) {
            // Hide all steps
            document.querySelectorAll('.form-section').forEach(section => {
                section.style.display = 'none';
            });

            // Show current step
            document.querySelector(`.form-section[data-step="${step}"]`).style.display = 'block';

            // Update step indicators
            document.querySelectorAll('.step').forEach((indicator, index) => {
                const stepNum = index + 1;
                indicator.classList.remove('active', 'completed');
                if (stepNum < step) {
                    indicator.classList.add('completed');
                } else if (stepNum === step) {
                    indicator.classList.add('active');
                }
            });

            // Update buttons
            document.getElementById('backBtn').style.display = step > 1 ? 'inline-flex' : 'none';
            document.getElementById('nextBtn').textContent = step === totalSteps ? 'Complete Setup →' : 'Continue →';

            updateProgress();
        }

        function validateCurrentStep() {
            const requiredFields = {
                1: ['brandName'],
                2: [], // No required fields in step 2
                3: []  // No required fields in step 3
            };

            const fields = requiredFields[currentStep] || [];
            let isValid = true;

            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.style.borderColor = '#dc3545';
                    isValid = false;
                } else {
                    field.style.borderColor = '#e9ecef';
                }
            });

            if (!isValid) {
                alert('Please fill in all required fields.');
            }

            return isValid;
        }

        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function completeOnboarding() {
            // Collect all form data
            const onboardingData = {
                brandName: document.getElementById('brandName').value,
                tagline: document.getElementById('tagline').value,
                primaryColor: document.querySelector('#primaryColors .color-option.selected')?.dataset.color || '#007bff',
                secondaryColor: document.querySelector('#secondaryColors .color-option.selected')?.dataset.color || '#6c757d',
                fontFamily: document.getElementById('fontFamily').value,
                brandVoice: document.getElementById('brandVoice').value,
                timezone: document.getElementById('timezone').value,
                currency: document.getElementById('currency').value,
                brandGuidelines: document.getElementById('brandGuidelines').value,
                welcomeMessage: document.getElementById('welcomeMessage').value,
                completedAt: new Date().toISOString()
            };

            // Save onboarding data
            localStorage.setItem('franchisorOnboardingData', JSON.stringify(onboardingData));

            // Show success message and redirect
            alert('Brand identity setup completed! Welcome to your franchisor dashboard.');

            // Redirect to franchisor dashboard
            window.location.href = '../[SU] Franchisor Management/franchisor_create_screen.html';
        }
    </script>
</body>
</html>
