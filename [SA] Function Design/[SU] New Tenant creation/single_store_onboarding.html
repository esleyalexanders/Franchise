<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Single Store Onboarding</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f5f7fa; color: #333; line-height: 1.6; }
        .container { max-width: 1000px; margin: 0 auto; padding: 40px 20px; }
        .header { text-align: center; margin-bottom: 40px; }
        .subtitle { color: #6c757d; margin-top: 8px; font-size: 16px; }
        .progress-bar { height: 6px; background: #e9ecef; border-radius: 3px; margin-bottom: 40px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #007bff, #28a745); width: 0%; transition: width 0.5s ease; }
        .onboarding-card { background: white; border-radius: 16px; padding: 40px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); margin-bottom: 32px; }
        .section-title { font-size: 24px; font-weight: 700; color: #2c3e50; margin-bottom: 8px; }
        .section-description { color: #6c757d; margin-bottom: 32px; font-size: 16px; }
        .form-section { margin-bottom: 40px; padding-bottom: 32px; border-bottom: 1px solid #e9ecef; }
        .form-section:last-child { border-bottom: none; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 24px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group.full-width { grid-column: 1 / -1; }
        label { font-weight: 500; margin-bottom: 6px; color: #495057; }
        .required { color: #dc3545; }
        input, select, textarea { padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; transition: border-color 0.3s ease; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #007bff; }
        textarea { resize: vertical; min-height: 100px; }
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 16px; }
        .checkbox-item { display: flex; align-items: center; gap: 8px; }
        .checkbox-item input[type="checkbox"] { width: auto; margin: 0; }
        .service-card { border: 2px solid #e9ecef; border-radius: 8px; padding: 20px; cursor: pointer; transition: all 0.3s ease; }
        .service-card:hover { border-color: #007bff; }
        .service-card.selected { border-color: #007bff; background: #f8f9ff; }
        .service-icon { font-size: 32px; margin-bottom: 12px; }
        .service-name { font-weight: 600; margin-bottom: 4px; }
        .service-description { font-size: 14px; color: #6c757d; }
        .staff-member { background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 16px; }
        .staff-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .staff-name { font-weight: 600; }
        .remove-staff { background: #dc3545; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px; }
        .actions { display: flex; gap: 16px; justify-content: space-between; align-items: center; }
        .btn { padding: 14px 28px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; transition: all .2s ease; }
        .btn-primary { background: #007bff; color: white; }
        .btn-primary:hover { background: #0056b3; transform: translateY(-1px); }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #5a6268; }
        .btn-outline { background: transparent; color: #6c757d; border: 2px solid #6c757d; }
        .btn-outline:hover { background: #6c757d; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #218838; }
        .step-indicator { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; }
        .step { width: 12px; height: 12px; border-radius: 50%; background: #e9ecef; transition: background 0.3s ease; }
        .step.active { background: #007bff; }
        .step.completed { background: #28a745; }
        .add-service-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Welcome to Your Store Dashboard</h1>
            <div class="subtitle">Let's set up your store with brand, payment, staff, and services</div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="step-indicator">
            <div class="step active" data-step="1"></div>
            <div class="step" data-step="2"></div>
            <div class="step" data-step="3"></div>
            <div class="step" data-step="4"></div>
        </div>

        <form class="onboarding-card" id="onboardingForm">
            <!-- Step 1: Brand Setup -->
            <div class="form-section" data-step="1">
                <h2 class="section-title">Store Branding</h2>
                <p class="section-description">Set up your store's visual identity and basic information.</p>

                <div class="form-row">
                    <div class="form-group">
                        <label for="storeName">Store Name <span class="required">*</span></label>
                        <input type="text" id="storeName" required placeholder="e.g., Downtown Burgers">
                    </div>
                    <div class="form-group">
                        <label for="storeTagline">Store Tagline</label>
                        <input type="text" id="storeTagline" placeholder="e.g., Best burgers in town">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="primaryColor">Primary Color</label>
                        <input type="color" id="primaryColor" value="#007bff">
                    </div>
                    <div class="form-group">
                        <label for="secondaryColor">Secondary Color</label>
                        <input type="color" id="secondaryColor" value="#6c757d">
                    </div>
                </div>
            </div>

            <!-- Step 2: Payment Setup -->
            <div class="form-section" data-step="2" style="display: none;">
                <h2 class="section-title">Payment Configuration</h2>
                <p class="section-description">Set up your payment methods and billing preferences.</p>

                <div class="form-row">
                    <div class="form-group">
                        <label>Accepted Payment Methods</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="cash" checked>
                                <label for="cash">Cash</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="card" checked>
                                <label for="card">Credit/Debit Cards</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="digital" checked>
                                <label for="digital">Digital Wallets (Apple Pay, Google Pay)</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="currency">Primary Currency</label>
                        <select id="currency">
                            <option value="AUD">Australian Dollar (AUD)</option>
                            <option value="USD">US Dollar (USD)</option>
                            <option value="NZD">New Zealand Dollar (NZD)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="taxRate">Tax Rate (%)</label>
                        <input type="number" id="taxRate" value="10" step="0.1">
                    </div>
                </div>
            </div>

            <!-- Step 3: Staff Setup -->
            <div class="form-section" data-step="3" style="display: none;">
                <h2 class="section-title">Staff Management</h2>
                <p class="section-description">Add your team members who will help run the store.</p>

                <div id="staffList">
                    <!-- Staff members will be added here -->
                </div>

                <div class="actions" style="justify-content: center; margin-top: 24px;">
                    <button type="button" class="btn btn-success" onclick="addStaffMember()">
                        + Add Staff Member
                    </button>
                </div>
            </div>

            <!-- Step 4: Services Setup -->
            <div class="form-section" data-step="4" style="display: none;">
                <h2 class="section-title">Services & Products</h2>
                <p class="section-description">Choose the services and products you'll offer at your store.</p>

                <div class="add-service-grid" id="servicesGrid">
                    <div class="service-card" data-service="dine-in" onclick="toggleService('dine-in')">
                        <div class="service-icon">üçΩÔ∏è</div>
                        <div class="service-name">Dine-in Service</div>
                        <div class="service-description">Table service and restaurant dining</div>
                    </div>
                    <div class="service-card" data-service="takeout" onclick="toggleService('takeout')">
                        <div class="service-icon">ü•°</div>
                        <div class="service-name">Takeout Orders</div>
                        <div class="service-description">Ready-to-go meals and pickup</div>
                    </div>
                    <div class="service-card" data-service="delivery" onclick="toggleService('delivery')">
                        <div class="service-icon">üõµ</div>
                        <div class="service-name">Delivery Service</div>
                        <div class="service-description">Home delivery through partners</div>
                    </div>
                    <div class="service-card" data-service="catering" onclick="toggleService('catering')">
                        <div class="service-icon">üéâ</div>
                        <div class="service-name">Catering</div>
                        <div class="service-description">Event and group catering services</div>
                    </div>
                    <div class="service-card" data-service="drive-thru" onclick="toggleService('drive-thru')">
                        <div class="service-icon">üöó</div>
                        <div class="service-name">Drive-thru</div>
                        <div class="service-description">Quick service drive-thru window</div>
                    </div>
                    <div class="service-card" data-service="online-orders" onclick="toggleService('online-orders')">
                        <div class="service-icon">üíª</div>
                        <div class="service-name">Online Ordering</div>
                        <div class="service-description">Website and app-based ordering</div>
                    </div>
                </div>
            </div>
        </form>

        <div class="actions">
            <button class="btn btn-outline" id="backBtn" onclick="previousStep()" style="display: none;">‚Üê Back</button>
            <div></div>
            <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">Continue ‚Üí</button>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 4;
        let staffMembers = [];
        let selectedServices = new Set(['dine-in', 'takeout']); // Default selections

        // Check authentication before allowing access
        function checkAuthentication() {
            // In a real app, this would check for a valid session/token
            // For demo purposes, check if user came from login or has recent login data
            const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true' ||
                              sessionStorage.getItem('authenticated') === 'true' ||
                              document.referrer.includes('auth_signin.html') ||
                              document.referrer.includes('single_store_login.html');

            if (!isLoggedIn) {
                // Redirect to single store login
                window.location.href = 'single_store_login.html';
                return false;
            }

            // Mark as authenticated for this session
            sessionStorage.setItem('authenticated', 'true');
            return true;
        }

        document.addEventListener('DOMContentLoaded', function() {
            if (!checkAuthentication()) {
                return; // Don't proceed if not authenticated
            }

            initializeForm();
            updateServicesDisplay();
        });

        function initializeForm() {
            // Load any existing store data if available
            const storeData = JSON.parse(localStorage.getItem('storeFormData') || '{}');

            if (storeData.businessName) {
                document.getElementById('storeName').value = storeData.businessName;
            }

            // Add at least one staff member (store owner)
            addStaffMember('Owner/Manager', true);

            updateProgress();
        }

        function addStaffMember(name = '', isOwner = false) {
            const staffId = Date.now();
            const staffMember = {
                id: staffId,
                name: name,
                role: isOwner ? 'Owner' : 'Staff',
                email: '',
                phone: '',
                isOwner: isOwner
            };

            staffMembers.push(staffMember);
            renderStaffMember(staffMember);
        }

        function renderStaffMember(staff) {
            const staffList = document.getElementById('staffList');
            const staffDiv = document.createElement('div');
            staffDiv.className = 'staff-member';
            staffDiv.dataset.staffId = staff.id;

            staffDiv.innerHTML = `
                <div class="staff-header">
                    <span class="staff-name">${staff.isOwner ? 'Store Owner/Manager' : 'Staff Member'}</span>
                    ${!staff.isOwner ? '<button type="button" class="remove-staff" onclick="removeStaffMember(' + staff.id + ')">Remove</button>' : ''}
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Name <span class="required">*</span></label>
                        <input type="text" value="${staff.name}" onchange="updateStaffField(${staff.id}, 'name', this.value)" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" onchange="updateStaffField(${staff.id}, 'email', this.value)">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" onchange="updateStaffField(${staff.id}, 'phone', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <select onchange="updateStaffField(${staff.id}, 'role', this.value)">
                            <option value="Staff" ${staff.role === 'Staff' ? 'selected' : ''}>Staff</option>
                            <option value="Manager" ${staff.role === 'Manager' ? 'selected' : ''}>Manager</option>
                            <option value="Chef" ${staff.role === 'Chef' ? 'selected' : ''}>Chef</option>
                            <option value="Server" ${staff.role === 'Server' ? 'selected' : ''}>Server</option>
                        </select>
                    </div>
                </div>
            `;

            staffList.appendChild(staffDiv);
        }

        function updateStaffField(staffId, field, value) {
            const staff = staffMembers.find(s => s.id === staffId);
            if (staff) {
                staff[field] = value;
            }
        }

        function removeStaffMember(staffId) {
            staffMembers = staffMembers.filter(s => s.id !== staffId);
            const staffDiv = document.querySelector(`[data-staff-id="${staffId}"]`);
            if (staffDiv) {
                staffDiv.remove();
            }
        }

        function toggleService(serviceId) {
            const serviceCard = document.querySelector(`[data-service="${serviceId}"]`);

            if (selectedServices.has(serviceId)) {
                selectedServices.delete(serviceId);
                serviceCard.classList.remove('selected');
            } else {
                selectedServices.add(serviceId);
                serviceCard.classList.add('selected');
            }
        }

        function updateServicesDisplay() {
            selectedServices.forEach(serviceId => {
                const serviceCard = document.querySelector(`[data-service="${serviceId}"]`);
                if (serviceCard) {
                    serviceCard.classList.add('selected');
                }
            });
        }

        function nextStep() {
            if (!validateCurrentStep()) {
                return;
            }

            if (currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
            } else {
                completeOnboarding();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }

        function showStep(step) {
            // Hide all steps
            document.querySelectorAll('.form-section').forEach(section => {
                section.style.display = 'none';
            });

            // Show current step
            document.querySelector(`.form-section[data-step="${step}"]`).style.display = 'block';

            // Update step indicators
            document.querySelectorAll('.step').forEach((indicator, index) => {
                const stepNum = index + 1;
                indicator.classList.remove('active', 'completed');
                if (stepNum < step) {
                    indicator.classList.add('completed');
                } else if (stepNum === step) {
                    indicator.classList.add('active');
                }
            });

            // Update buttons
            document.getElementById('backBtn').style.display = step > 1 ? 'inline-flex' : 'none';
            document.getElementById('nextBtn').textContent = step === totalSteps ? 'Complete Setup ‚Üí' : 'Continue ‚Üí';

            updateProgress();
        }

        function validateCurrentStep() {
            let isValid = true;

            switch(currentStep) {
                case 1:
                    if (!document.getElementById('storeName').value.trim()) {
                        alert('Please enter a store name.');
                        isValid = false;
                    }
                    break;
                case 3:
                    // Validate that at least the owner has a name
                    const ownerStaff = staffMembers.find(s => s.isOwner);
                    if (!ownerStaff || !ownerStaff.name.trim()) {
                        alert('Please enter the store owner/manager name.');
                        isValid = false;
                    }
                    break;
            }

            return isValid;
        }

        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function completeOnboarding() {
            // Collect all form data
            const onboardingData = {
                storeName: document.getElementById('storeName').value,
                storeTagline: document.getElementById('storeTagline').value,
                primaryColor: document.getElementById('primaryColor').value,
                secondaryColor: document.getElementById('secondaryColor').value,
                paymentMethods: {
                    cash: document.getElementById('cash').checked,
                    card: document.getElementById('card').checked,
                    digital: document.getElementById('digital').checked
                },
                currency: document.getElementById('currency').value,
                taxRate: parseFloat(document.getElementById('taxRate').value),
                staffMembers: staffMembers,
                services: Array.from(selectedServices),
                completedAt: new Date().toISOString()
            };

            // Save onboarding data
            localStorage.setItem('singleStoreOnboardingData', JSON.stringify(onboardingData));

            // Show success message and redirect
            alert('Store setup completed! Welcome to your store dashboard.');

            // Redirect to store dashboard
            window.location.href = '../[SU] Franchisor Management/Tenant_managment_screen.html';
        }
    </script>
</body>
</html>
