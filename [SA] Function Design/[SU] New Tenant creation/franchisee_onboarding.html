<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Franchisee Onboarding</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f5f7fa; color: #333; line-height: 1.6; }
        .container { max-width: 1000px; margin: 0 auto; padding: 40px 20px; }
        .header { text-align: center; margin-bottom: 40px; }
        .subtitle { color: #6c757d; margin-top: 8px; font-size: 16px; }
        .progress-bar { height: 6px; background: #e9ecef; border-radius: 3px; margin-bottom: 40px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #007bff, #28a745); width: 0%; transition: width 0.5s ease; }
        .onboarding-card { background: white; border-radius: 16px; padding: 40px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); margin-bottom: 32px; }
        .welcome-section { background: linear-gradient(135deg, #007bff, #0056b3); color: white; border-radius: 12px; padding: 32px; margin-bottom: 32px; text-align: center; }
        .welcome-title { font-size: 28px; font-weight: 700; margin-bottom: 8px; }
        .welcome-message { font-size: 16px; opacity: 0.9; }
        .section-title { font-size: 24px; font-weight: 700; color: #2c3e50; margin-bottom: 8px; }
        .section-description { color: #6c757d; margin-bottom: 32px; font-size: 16px; }
        .form-section { margin-bottom: 40px; padding-bottom: 32px; border-bottom: 1px solid #e9ecef; }
        .form-section:last-child { border-bottom: none; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 24px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group.full-width { grid-column: 1 / -1; }
        label { font-weight: 500; margin-bottom: 6px; color: #495057; }
        .required { color: #dc3545; }
        input, select, textarea { padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; transition: border-color 0.3s ease; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #007bff; }
        textarea { resize: vertical; min-height: 100px; }
        .service-card { border: 2px solid #e9ecef; border-radius: 8px; padding: 20px; cursor: pointer; transition: all 0.3s ease; }
        .service-card:hover { border-color: #007bff; }
        .service-card.selected { border-color: #007bff; background: #f8f9ff; }
        .service-icon { font-size: 32px; margin-bottom: 12px; }
        .service-name { font-weight: 600; margin-bottom: 4px; }
        .service-description { font-size: 14px; color: #6c757d; }
        .staff-member { background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 16px; }
        .staff-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .staff-name { font-weight: 600; }
        .remove-staff { background: #dc3545; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px; }
        .actions { display: flex; gap: 16px; justify-content: space-between; align-items: center; }
        .btn { padding: 14px 28px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; transition: all .2s ease; }
        .btn-primary { background: #007bff; color: white; }
        .btn-primary:hover { background: #0056b3; transform: translateY(-1px); }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #5a6268; }
        .btn-outline { background: transparent; color: #6c757d; border: 2px solid #6c757d; }
        .btn-outline:hover { background: #6c757d; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #218838; }
        .step-indicator { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; }
        .step { width: 12px; height: 12px; border-radius: 50%; background: #e9ecef; transition: background 0.3s ease; }
        .step.active { background: #007bff; }
        .step.completed { background: #28a745; }
        .franchisor-info { background: #e7f3ff; border-left: 4px solid #007bff; padding: 20px; border-radius: 8px; margin-bottom: 24px; }
        .franchisor-info h3 { color: #007bff; margin-bottom: 8px; }
        .add-service-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="welcome-section">
            <h1 class="welcome-title">Welcome to Your Franchise!</h1>
            <p class="welcome-message">Congratulations on joining the network. Let's set up your location for success.</p>
        </div>

        <div class="franchisor-info">
            <h3>Your Franchisor</h3>
            <p id="franchisorName">Loading franchisor information...</p>
            <p>You are now part of their network. Follow their brand guidelines and operational standards.</p>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="step-indicator">
            <div class="step active" data-step="1"></div>
            <div class="step" data-step="2"></div>
            <div class="step" data-step="3"></div>
        </div>

        <form class="onboarding-card" id="onboardingForm">
            <!-- Step 1: Location Setup -->
            <div class="form-section" data-step="1">
                <h2 class="section-title">Location Information</h2>
                <p class="section-description">Confirm your franchise location details and operating information.</p>

                <div class="form-row">
                    <div class="form-group">
                        <label for="locationName">Location Name <span class="required">*</span></label>
                        <input type="text" id="locationName" required placeholder="e.g., Downtown Location">
                    </div>
                    <div class="form-group">
                        <label for="managerName">Location Manager <span class="required">*</span></label>
                        <input type="text" id="managerName" required placeholder="Full name">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="openingDate">Opening Date</label>
                        <input type="date" id="openingDate">
                    </div>
                    <div class="form-group">
                        <label for="contactPhone">Contact Phone <span class="required">*</span></label>
                        <input type="tel" id="contactPhone" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group full-width">
                        <label for="specialNotes">Special Notes or Requirements</label>
                        <textarea id="specialNotes" placeholder="Any special considerations for your location (parking, accessibility, etc.)"></textarea>
                    </div>
                </div>
            </div>

            <!-- Step 2: Staff Setup -->
            <div class="form-section" data-step="2" style="display: none;">
                <h2 class="section-title">Staff Management</h2>
                <p class="section-description">Add your team members who will help run this location.</p>

                <div id="staffList">
                    <!-- Staff members will be added here -->
                </div>

                <div class="actions" style="justify-content: center; margin-top: 24px;">
                    <button type="button" class="btn btn-success" onclick="addStaffMember()">
                        + Add Staff Member
                    </button>
                </div>
            </div>

            <!-- Step 3: Services Configuration -->
            <div class="form-section" data-step="3" style="display: none;">
                <h2 class="section-title">Services & Operations</h2>
                <p class="section-description">Configure which services you'll offer and your operating preferences.</p>

                <div class="form-row">
                    <div class="form-group">
                        <label for="operatingHours">Standard Operating Hours</label>
                        <select id="operatingHours">
                            <option value="standard">Standard Hours (9am-5pm)</option>
                            <option value="extended">Extended Hours (8am-8pm)</option>
                            <option value="247">24/7 Operation</option>
                            <option value="custom">Custom Hours</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="capacity">Location Capacity</label>
                        <select id="capacity">
                            <option value="small">Small (up to 50 customers)</option>
                            <option value="medium">Medium (50-150 customers)</option>
                            <option value="large">Large (150+ customers)</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Available Services</label>
                        <div class="add-service-grid" id="servicesGrid">
                            <div class="service-card selected" data-service="dine-in" onclick="toggleService('dine-in')">
                                <div class="service-icon">🍽️</div>
                                <div class="service-name">Dine-in Service</div>
                                <div class="service-description">Table service and restaurant dining</div>
                            </div>
                            <div class="service-card selected" data-service="takeout" onclick="toggleService('takeout')">
                                <div class="service-icon">🥡</div>
                                <div class="service-name">Takeout Orders</div>
                                <div class="service-description">Ready-to-go meals and pickup</div>
                            </div>
                            <div class="service-card" data-service="delivery" onclick="toggleService('delivery')">
                                <div class="service-icon">🛵</div>
                                <div class="service-name">Delivery Service</div>
                                <div class="service-description">Home delivery through partners</div>
                            </div>
                            <div class="service-card" data-service="catering" onclick="toggleService('catering')">
                                <div class="service-icon">🎉</div>
                                <div class="service-name">Catering</div>
                                <div class="service-description">Event and group catering services</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group full-width">
                        <label for="additionalServices">Additional Services or Customizations</label>
                        <textarea id="additionalServices" placeholder="Describe any additional services or special features you'll offer at this location"></textarea>
                    </div>
                </div>
            </div>
        </form>

        <div class="actions">
            <button class="btn btn-outline" id="backBtn" onclick="previousStep()" style="display: none;">← Back</button>
            <div></div>
            <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">Continue →</button>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 3;
        let staffMembers = [];
        let selectedServices = new Set(['dine-in', 'takeout']); // Default selections

        document.addEventListener('DOMContentLoaded', function() {
            initializeForm();
            loadFranchisorInfo();
            updateServicesDisplay();
        });

        function initializeForm() {
            // Load any existing franchisee data if available
            const franchiseeData = JSON.parse(localStorage.getItem('franchiseeFormData') || '[]');

            if (franchiseeData.length > 0) {
                // Use the first franchisee data for this location
                const data = franchiseeData[0];
                document.getElementById('locationName').value = data.name || '';
            }

            // Add at least one staff member (manager)
            addStaffMember(document.getElementById('managerName').value || '', true);

            updateProgress();
        }

        function loadFranchisorInfo() {
            // Load franchisor information from stored data
            const franchisorData = JSON.parse(localStorage.getItem('franchisorFormData') || '{}');

            if (franchisorData.businessName) {
                document.getElementById('franchisorName').textContent =
                    `${franchisorData.businessName} - ${franchisorData.contactName} (${franchisorData.email})`;
            } else {
                document.getElementById('franchisorName').textContent =
                    'Franchisor information will be provided by the system.';
            }
        }

        function addStaffMember(name = '', isManager = false) {
            const staffId = Date.now();
            const staffMember = {
                id: staffId,
                name: name,
                role: isManager ? 'Manager' : 'Staff',
                email: '',
                phone: '',
                isManager: isManager
            };

            staffMembers.push(staffMember);
            renderStaffMember(staffMember);
        }

        function renderStaffMember(staff) {
            const staffList = document.getElementById('staffList');
            const staffDiv = document.createElement('div');
            staffDiv.className = 'staff-member';
            staffDiv.dataset.staffId = staff.id;

            staffDiv.innerHTML = `
                <div class="staff-header">
                    <span class="staff-name">${staff.isManager ? 'Location Manager' : 'Staff Member'}</span>
                    ${!staff.isManager ? '<button type="button" class="remove-staff" onclick="removeStaffMember(' + staff.id + ')">Remove</button>' : ''}
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Name <span class="required">*</span></label>
                        <input type="text" value="${staff.name}" onchange="updateStaffField(${staff.id}, 'name', this.value)" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" onchange="updateStaffField(${staff.id}, 'email', this.value)">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" onchange="updateStaffField(${staff.id}, 'phone', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <select onchange="updateStaffField(${staff.id}, 'role', this.value)">
                            <option value="Staff" ${staff.role === 'Staff' ? 'selected' : ''}>Staff</option>
                            <option value="Assistant Manager" ${staff.role === 'Assistant Manager' ? 'selected' : ''}>Assistant Manager</option>
                            <option value="Chef" ${staff.role === 'Chef' ? 'selected' : ''}>Chef</option>
                            <option value="Server" ${staff.role === 'Server' ? 'selected' : ''}>Server</option>
                            <option value="Cashier" ${staff.role === 'Cashier' ? 'selected' : ''}>Cashier</option>
                        </select>
                    </div>
                </div>
            `;

            staffList.appendChild(staffDiv);
        }

        function updateStaffField(staffId, field, value) {
            const staff = staffMembers.find(s => s.id === staffId);
            if (staff) {
                staff[field] = value;
                // Update manager name if it's the manager
                if (staff.isManager && field === 'name') {
                    document.getElementById('managerName').value = value;
                }
            }
        }

        function removeStaffMember(staffId) {
            staffMembers = staffMembers.filter(s => s.id !== staffId);
            const staffDiv = document.querySelector(`[data-staff-id="${staffId}"]`);
            if (staffDiv) {
                staffDiv.remove();
            }
        }

        function toggleService(serviceId) {
            const serviceCard = document.querySelector(`[data-service="${serviceId}"]`);

            if (selectedServices.has(serviceId)) {
                selectedServices.delete(serviceId);
                serviceCard.classList.remove('selected');
            } else {
                selectedServices.add(serviceId);
                serviceCard.classList.add('selected');
            }
        }

        function updateServicesDisplay() {
            selectedServices.forEach(serviceId => {
                const serviceCard = document.querySelector(`[data-service="${serviceId}"]`);
                if (serviceCard) {
                    serviceCard.classList.add('selected');
                }
            });
        }

        function nextStep() {
            if (!validateCurrentStep()) {
                return;
            }

            if (currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
            } else {
                completeOnboarding();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }

        function showStep(step) {
            // Hide all steps
            document.querySelectorAll('.form-section').forEach(section => {
                section.style.display = 'none';
            });

            // Show current step
            document.querySelector(`.form-section[data-step="${step}"]`).style.display = 'block';

            // Update step indicators
            document.querySelectorAll('.step').forEach((indicator, index) => {
                const stepNum = index + 1;
                indicator.classList.remove('active', 'completed');
                if (stepNum < step) {
                    indicator.classList.add('completed');
                } else if (stepNum === step) {
                    indicator.classList.add('active');
                }
            });

            // Update buttons
            document.getElementById('backBtn').style.display = step > 1 ? 'inline-flex' : 'none';
            document.getElementById('nextBtn').textContent = step === totalSteps ? 'Complete Setup →' : 'Continue →';

            updateProgress();
        }

        function validateCurrentStep() {
            let isValid = true;

            switch(currentStep) {
                case 1:
                    if (!document.getElementById('locationName').value.trim()) {
                        alert('Please enter a location name.');
                        isValid = false;
                    }
                    if (!document.getElementById('managerName').value.trim()) {
                        alert('Please enter the location manager name.');
                        isValid = false;
                    }
                    if (!document.getElementById('contactPhone').value.trim()) {
                        alert('Please enter a contact phone number.');
                        isValid = false;
                    }
                    break;
                case 2:
                    // Validate that at least the manager has a name
                    const managerStaff = staffMembers.find(s => s.isManager);
                    if (!managerStaff || !managerStaff.name.trim()) {
                        alert('Please enter the location manager name.');
                        isValid = false;
                    }
                    break;
            }

            return isValid;
        }

        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function completeOnboarding() {
            // Collect all form data
            const onboardingData = {
                locationName: document.getElementById('locationName').value,
                managerName: document.getElementById('managerName').value,
                openingDate: document.getElementById('openingDate').value,
                contactPhone: document.getElementById('contactPhone').value,
                specialNotes: document.getElementById('specialNotes').value,
                operatingHours: document.getElementById('operatingHours').value,
                capacity: document.getElementById('capacity').value,
                staffMembers: staffMembers,
                services: Array.from(selectedServices),
                additionalServices: document.getElementById('additionalServices').value,
                completedAt: new Date().toISOString()
            };

            // Save onboarding data
            localStorage.setItem('franchiseeOnboardingData', JSON.stringify(onboardingData));

            // Show success message and redirect
            alert('Franchisee setup completed! Welcome to your location dashboard.');

            // Redirect to franchisee dashboard
            window.location.href = '../[SU] Franchisee/franchisee_create_screen.html';
        }
    </script>
</body>
</html>
